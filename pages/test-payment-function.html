<!DOCTYPE html>
<html>
<head>
  <title>Test Payment Function</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>
</head>
<body>
  <h1>Test Payment Function</h1>
  <button id="testBtn">Test createPaymentOrder</button>
  <pre id="results" style="background-color: #f0f0f0; padding: 10px; margin-top: 20px;"></pre>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCAl15Yq8Y727PKknJNs0Q8UZbRRbcWkMo",
      authDomain: "snapselect01-eb74c.firebaseapp.com",
      projectId: "snapselect01-eb74c",
      storageBucket: "snapselect01-eb74c.firebasestorage.app",
      messagingSenderId: "749450852067",
      appId: "1:749450852067:web:8b1887075d607b3e91f7d6",
      measurementId: "G-J5XGE71VF6"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    
    // Display log messages in the UI
    function log(message) {
      const resultsElement = document.getElementById('results');
      if (typeof message === 'object') {
        resultsElement.textContent += JSON.stringify(message, null, 2) + '\n';
      } else {
        resultsElement.textContent += message + '\n';
      }
    }
    
    // Sign in anonymously for testing
    async function ensureSignedIn() {
      try {
        if (!firebase.auth().currentUser) {
          log("Signing in anonymously...");
          await firebase.auth().signInAnonymously();
          log("Signed in successfully");
        } else {
          log("Already signed in as: " + firebase.auth().currentUser.uid);
        }
        return true;
      } catch (error) {
        log("Error signing in: " + error.message);
        return false;
      }
    }
    
    // Test the createPaymentOrder function
    async function testCreatePaymentOrder() {
      try {
        // Clear previous results
        document.getElementById('results').textContent = '';
        
        // Ensure signed in
        const signedIn = await ensureSignedIn();
        if (!signedIn) return;
        
        // Set the region
        log("Setting functions region to asia-south1");
        const functions = firebase.app().functions("asia-south1");
        
        // Call the function
        log("Calling createPaymentOrder function...");
        const createPaymentOrder = functions.httpsCallable('createPaymentOrder');
        
        const result = await createPaymentOrder({
          planType: 'basic',
          amount: 499
        });
        
        log("Function call successful!");
        log(result.data);
      } catch (error) {
        log("Error calling function:");
        log("Code: " + (error.code || 'unknown'));
        log("Message: " + error.message);
        if (error.details) {
          log("Details: ");
          log(error.details);
        }
      }
    }
    
    // Add event listener
    document.getElementById('testBtn').addEventListener('click', testCreatePaymentOrder);
  </script>
</body>
</html>
